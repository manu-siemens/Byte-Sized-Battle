<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Cyber Sleuth Challenge - Leaderboard</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
  body {
    background-color: #121212;
    color: #e0e0e0;
    font-family: 'Montserrat', sans-serif;
    margin: 0;
    padding: 0;
    width: 1280px;
    min-height: 720px;
  }
  .container {
    width: 1280px;
    min-height: 720px;
    padding: 40px;
    box-sizing: border-box;
  }
  .header {
    border-bottom: 2px solid #2563eb;
    padding-bottom: 10px;
    margin-bottom: 30px;
  }
  .leaderboard-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
    border-radius: 10px;
    overflow: hidden;
    background-color: #1e1e1e;
  }
  .leaderboard-table th {
    background-color: #2563eb;
    color: #fff;
    text-align: left;
    padding: 12px 16px;
    font-weight: 700;
  }
  .leaderboard-table td {
    padding: 12px 16px;
    border-bottom: 1px solid #2d2d2d;
  }
  .leaderboard-table tr:hover {
    background-color: #2d3748;
    transition: all 0.2s ease;
  }
  .rank-badge {
    font-weight: bold;
    background-color: #3b82f6;
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
  }
</style>
</head>
<body>
<div class="container">
  <div class="header flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-blue-400">Cyber Sleuth Challenge</h1>
      <h2 class="text-xl mt-2 text-gray-300">üèÜ Leaderboard</h2>
    </div>
    <a href="index.html" class="text-blue-400 hover:underline text-lg"><i class="fas fa-arrow-left"></i> Back to Quiz</a>
  </div>

  <div id="leaderboard-section">
    <p class="text-lg text-gray-400 mb-4">Fetching latest scores... ‚è≥</p>
    <table id="leaderboard" class="leaderboard-table hidden">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Name</th>
          <th>Email</th>
          <th>Score</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody id="leaderboard-body"></tbody>
    </table>
  </div>

  <div class="footer mt-10 text-left text-gray-400 text-sm">
    <p>October Cybersecurity Awareness Month</p>
  </div>
</div>

<!-- ‚úÖ Firebase SDK (modern v12 modular) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

  // ‚úÖ Your Firebase Config (same as quiz pages)
  const firebaseConfig = {
    apiKey: "AIzaSyCDxtG36Qeyhh1nfRypGPDOdvfQgO9_oIA",
    authDomain: "byte-sized-battle.firebaseapp.com",
    databaseURL: "https://byte-sized-battle-default-rtdb.firebaseio.com/",
    projectId: "byte-sized-battle",
    storageBucket: "byte-sized-battle.firebasestorage.app",
    messagingSenderId: "278675191581",
    appId: "1:278675191581:web:410e9faeebb804295453f4",
    measurementId: "G-6QSQDBHR14"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const leaderboardBody = document.getElementById("leaderboard-body");
  const leaderboardTable = document.getElementById("leaderboard");
  const leaderboardSection = document.getElementById("leaderboard-section");

  function formatDate(ts) {
    const d = new Date(ts);
    return d.toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' });
  }

  // ‚úÖ Fetch leaderboard data live
  const scoresRef = ref(db, 'quizScores/');
  onValue(scoresRef, (snapshot) => {
    const data = snapshot.val();
    if (!data) {
      leaderboardSection.innerHTML = "<p class='text-gray-400'>No quiz submissions yet üïµÔ∏è‚Äç‚ôÇÔ∏è</p>";
      return;
    }

    // Convert object ‚Üí array and sort
    const entries = Object.values(data).sort((a, b) => b.score - a.score || a.timestamp - b.timestamp);

    leaderboardBody.innerHTML = "";
    entries.forEach((entry, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><span class="rank-badge">#${index + 1}</span></td>
        <td>${entry.name || "Anonymous"}</td>
        <td>${entry.email || "-"}</td>
        <td class="font-bold text-blue-400">${entry.score}/10</td>
        <td>${formatDate(entry.timestamp)}</td>
      `;
      leaderboardBody.appendChild(tr);
    });

    document.querySelector("#leaderboard-section p").style.display = "none";
    leaderboardTable.classList.remove("hidden");
  });
</script>
</body>
</html>